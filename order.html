<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management - POS System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Raleway:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/order.css">
</head>
<body>
    <div class="main-wrapper">
        <div class="container">
            <!-- Branded Header -->
            <div class="branded-header">
                <div class="brand-logo">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="brand-info">
                    <h1>PRISTINE DINING</h1>
                    <p>Order Management System</p>
                </div>
            </div>

            <div class="header-section">
                <div class="title-group">
                    <h2><i class="fas fa-receipt"></i> Orders</h2>
                    <p class="subtitle">Manage and track all customer orders</p>
                </div>
                <div class="stats-group">
                    <div class="stat-card">
                        <span class="stat-number" id="total-orders">0</span>
                        <span class="stat-label">Total Orders</span>
                    </div>
                    <div class="stat-card pending-stat">
                        <span class="stat-number" id="pending-orders">0</span>
                        <span class="stat-label">Pending</span>
                    </div>
                    <div class="stat-card completed-stat">
                        <span class="stat-number" id="completed-orders-count">0</span>
                        <span class="stat-label">Completed</span>
                    </div>
                </div>
            </div>

        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Search by Order ID or Customer Name...">
            <button class="clear-search-btn" onclick="clearSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="main-layout">
            <!-- Pending Orders Section -->
            <div class="orders-section">
                <div class="section-header">
                    <h2><i class="fas fa-hourglass-half"></i> Pending Orders</h2>
                    <span class="badge-count" id="pending-badge">0</span>
                </div>
                <div id="pending-orders-container" class="cards-grid">
                    <!-- Pending orders will be displayed as cards here -->
                </div>
            </div>

            <!-- Completed Orders Section -->
            <div class="orders-section">
                <div class="section-header">
                    <h2><i class="fas fa-check-circle"></i> Completed Orders</h2>
                    <span class="badge-count completed-badge" id="completed-badge">0</span>
                </div>
                <div id="completed-orders-container" class="cards-grid">
                    <!-- Completed orders will be displayed as cards here -->
                </div>
                <button onclick="clearOrders()" class="clear-btn" style="margin-top: 20px;">
                    <i class="fas fa-trash"></i> Clear Completed Orders
                </button>
            </div>
        </div>

        </div>
    </div>

    <!-- Fixed Navigation Popup -->
    <div class="nav-popup-overlay" id="navOverlay"></div>
    <div class="nav-popup" id="navPopup">
        <button class="nav-popup-close" onclick="closeNavPopup()">
            <i class="fas fa-times"></i>
        </button>
        <h3>Test Pages</h3>
        <nav class="nav-popup-list">
            <a href="login.html" class="nav-popup-link">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
            <a href="register.html" class="nav-popup-link">
                <i class="fas fa-user-plus"></i> Register
            </a>
            <a href="order.html" class="nav-popup-link active">
                <i class="fas fa-receipt"></i> Orders
            </a>
            <a href="reservation.html" class="nav-popup-link">
                <i class="fas fa-calendar-alt"></i> Reservations
            </a>
            <a href="restaurant_bill.html" class="nav-popup-link">
                <i class="fas fa-file-invoice"></i> Bill
            </a>
            <a href="restaurant_reception.html" class="nav-popup-link">
                <i class="fas fa-door-open"></i> Reception
            </a>
        </nav>
    </div>

    <button class="nav-popup-btn" onclick="toggleNavPopup()">
        <i class="fas fa-bars"></i>
    </button>

    <script>
        // Navigation Popup Functions
        function toggleNavPopup() {
            const popup = document.getElementById('navPopup');
            const overlay = document.getElementById('navOverlay');
            popup.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeNavPopup() {
            const popup = document.getElementById('navPopup');
            const overlay = document.getElementById('navOverlay');
            popup.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Close popup when clicking overlay
        document.getElementById('navOverlay').addEventListener('click', closeNavPopup);

        // Close popup when pressing Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeNavPopup();
        });

        // Orders Management Functions
        const totalOrdersSpan = document.getElementById('total-orders');
        const pendingOrdersSpan = document.getElementById('pending-orders');
        const completedOrdersCountSpan = document.getElementById('completed-orders-count');
        const pendingOrdersContainer = document.getElementById('pending-orders-container');
        const completedOrdersContainer = document.getElementById('completed-orders-container');
        const pendingBadge = document.getElementById('pending-badge');
        const completedBadge = document.getElementById('completed-badge');
        const searchInput = document.getElementById('search-input');
        const clearSearchBtn = document.querySelector('.clear-search-btn');

        let orders = [
            { id: '#1001', customer: 'John Doe', items: 'Pizza, Coke', price: '$25.50', status: 'Pending', time: '2:30 PM' },
            { id: '#1002', customer: 'Jane Smith', items: 'Burger, Fries', price: '$15.00', status: 'Pending', time: '2:45 PM' },
            { id: '#1003', customer: 'Alice Wonderland', items: 'Salad, Iced Tea', price: '$12.75', status: 'Pending', time: '2:50 PM' },
            { id: '#1004', customer: 'Bob Johnson', items: 'Fish & Chips', price: '$18.90', status: 'Pending', time: '3:05 PM' },
            { id: '#1005', customer: 'Emily Chen', items: 'Pasta, Wine', price: '$32.50', status: 'Pending', time: '3:15 PM' },
            { id: '#1006', customer: 'Michael Brown', items: 'Steak, Potatoes', price: '$45.00', status: 'Pending', time: '3:20 PM' },
            { id: '#1007', customer: 'Sarah Davis', items: 'Sushi, Green Tea', price: '$28.75', status: 'Pending', time: '3:25 PM' },
            { id: '#1008', customer: 'David Wilson', items: 'Chicken Sandwich', price: '$14.50', status: 'Pending', time: '3:30 PM' },
        ];
        let completedOrders = [];
        let filteredOrders = [...orders];

        function updateOrderCounts() {
            const pendingCount = orders.filter(o => o.status === 'Pending').length;
            const completedCount = completedOrders.length;
            const total = pendingCount + completedCount;

            totalOrdersSpan.textContent = total;
            pendingOrdersSpan.textContent = pendingCount;
            completedOrdersCountSpan.textContent = completedCount;
            pendingBadge.textContent = pendingCount;
            completedBadge.textContent = completedCount;
        }

        function renderOrders(ordersToRender = null) {
            const displayOrders = ordersToRender || orders;
            pendingOrdersContainer.innerHTML = '';

            displayOrders.filter(o => o.status === 'Pending').forEach((order, index) => {
                const originalIndex = orders.findIndex(o => o.id === order.id);
                const card = document.createElement('div');
                card.classList.add('order-card');
                card.innerHTML = `
                    <div class="card-header">
                        <span class="order-id">${order.id}</span>
                        <span class="order-time"><i class="fas fa-clock"></i> ${order.time}</span>
                    </div>
                    <div class="card-body">
                        <h3 class="customer-name">${order.customer}</h3>
                        <p class="order-items">${order.items}</p>
                        <div class="card-footer">
                            <span class="order-price">${order.price}</span>
                            <button onclick="completeOrder(${originalIndex})" class="btn-complete">
                                <i class="fas fa-check"></i> Complete
                            </button>
                        </div>
                    </div>
                `;
                pendingOrdersContainer.appendChild(card);
            });

            // If no pending orders, show empty state
            if (displayOrders.filter(o => o.status === 'Pending').length === 0) {
                pendingOrdersContainer.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i> <p>No pending orders</p></div>';
            }
        }

        function renderCompletedOrders(ordersToRender = null) {
            const displayOrders = ordersToRender || completedOrders;
            completedOrdersContainer.innerHTML = '';

            displayOrders.filter(o => o.status === 'Completed').forEach((order) => {
                const card = document.createElement('div');
                card.classList.add('order-card', 'completed');
                card.innerHTML = `
                    <div class="card-header">
                        <span class="order-id">${order.id}</span>
                        <span class="status-badge"><i class="fas fa-check-circle"></i> Completed</span>
                    </div>
                    <div class="card-body">
                        <h3 class="customer-name">${order.customer}</h3>
                        <p class="order-items">${order.items}</p>
                        <div class="card-footer">
                            <span class="order-price">${order.price}</span>
                        </div>
                    </div>
                `;
                completedOrdersContainer.appendChild(card);
            });

            // If no completed orders, show empty state
            if (displayOrders.filter(o => o.status === 'Completed').length === 0) {
                completedOrdersContainer.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i> <p>No completed orders</p></div>';
            }
        }

        function clearOrders() {
            if (confirm('Are you sure you want to clear all completed orders?')) {
                completedOrders = [];
                sessionStorage.setItem('completedOrders', JSON.stringify(completedOrders));
                updateOrderCounts();
                renderCompletedOrders();
            }
        }

        function completeOrder(index) {
            const order = orders[index];
            order.status = 'Completed';
            completedOrders.push({...order});
            orders.splice(index, 1);
            sessionStorage.setItem('completedOrders', JSON.stringify(completedOrders));
            updateOrderCounts();
            renderOrders(filteredOrders);
            renderCompletedOrders();
        }

        function searchOrders() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (searchTerm === '') {
                filteredOrders = [...orders];
                clearSearchBtn.style.display = 'none';
            } else {
                filteredOrders = orders.filter(order =>
                    order.id.toLowerCase().includes(searchTerm) ||
                    order.customer.toLowerCase().includes(searchTerm)
                );
                clearSearchBtn.style.display = 'block';
            }
            renderOrders(filteredOrders);
        }

        function clearSearch() {
            searchInput.value = '';
            filteredOrders = [...orders];
            clearSearchBtn.style.display = 'none';
            renderOrders();
        }

        // Event listeners
        searchInput.addEventListener('input', searchOrders);

        // Load completed orders from session storage
        const lastResetDate = sessionStorage.getItem('lastResetDate');
        const today = new Date().toDateString();

        if (lastResetDate !== today) {
            sessionStorage.setItem('completedOrders', JSON.stringify([]));
            sessionStorage.setItem('lastResetDate', today);
        } else {
            const storedCompletedOrders = sessionStorage.getItem('completedOrders');
            if (storedCompletedOrders) {
                completedOrders = JSON.parse(storedCompletedOrders);
            }
        }

        // Initial render
        updateOrderCounts();
        renderOrders();
        renderCompletedOrders();
    </script>
</body>
</html>